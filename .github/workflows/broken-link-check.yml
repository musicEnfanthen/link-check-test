name: Broken Link Check

on:
  schedule:
    - cron: 0 12 1/7 * * # run weekly
  workflow_dispatch: # run manually
  # push:
  #   branches: [ master ]
  # pull_request:
  #   branches: [ master ]

jobs:
  check:
    name: Check broken links
    runs-on: ubuntu-latest
    continue-on-error: true
    
    steps:
      - name: Broken Link Check MEI
        uses: technote-space/broken-link-checker-action@v2
        with:
          target: https://music-encoding.org/

      - name: Check MEI with ruzickap action
        if: always()
        uses: ruzickap/action-my-broken-link-checker@v2
        with:
          url: https://music-encoding.org/

      - name: Broken Link Check Verovio
        if: always()
        uses: technote-space/broken-link-checker-action@v2
        with:
          target: https://www.verovio.org/      
      
      - name: Check Verovio with ruzickap action
        if: always()
        uses: ruzickap/action-my-broken-link-checker@v2
        with:
          url: https://www.verovio.org/  

      - name: Broken Link Check AWG
        if: always()
        uses: technote-space/broken-link-checker-action@v2
        with:
          target: https://edition.anton-webern.ch/
      
      - name: Check AWG with ruzickap action
        if: always()
        uses: ruzickap/action-my-broken-link-checker@v2
        with:
          url: https://edition.anton-webern.ch/
      
      
      
  markdown-link-check:
    name: Check markdown links
    runs-on: ubuntu-latest
    continue-on-error: true
    
    steps:
    - uses: actions/checkout@v2
      
    - uses: actions/checkout@v2
      with:
        repository: musicEnfanthen/music-encoding.github.io
        ref: master
        path: check-dir
      
    - name: Check file path
      run: |
        ls -alh  
    
    - uses: gaurav-nelson/github-action-markdown-link-check@1.0.8
      with:
        folder-path: check-dir
        config-file: .github/link-check-config.json
        use-quiet-mode: 'yes'
        use-verbose-mode: 'yes'
   
    - name: Check context
      if: always()
      run: |
        echo "${{ github.repository_owner }}"
        echo "${{ github.repository }}"
        echo "${{ github.context.repo.owner }}"
        echo "${{ github.context.repo.repo }}"
   
    - name: Add comment with link
      if: always()
      uses: actions/github-script@v3
      with:
        github-token: ${{secrets.GITHUB_TOKEN}}
        script: |
          github.issues.createComment({
            owner: context.repo.owner,
            repo: context.repo.repo,
            body: 'Got a broken link'
          })
